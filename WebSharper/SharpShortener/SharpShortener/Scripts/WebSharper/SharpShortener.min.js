(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;$.Define($$,{SharpShortener:{Addresse:{externFromString:function(F,G){return b.bind(function(H){return d.externFromUrl(F,H);},e.fromString(G));},externFromUrl:function(I,J){return d.isLink(I,J)?{$:0}:{$:1,$0:{$:0,$0:J}};},externToUrl:function(K){return K.$0;},getId:function(L){return L.$0;},isLink:function(M,N){return d.linkFromUrl(M,N).$==1;},link:function(O){return{$:0,$0:O};},linkFromString:function(P,Q){return b.bind(function(R){return d.linkFromUrl(P,R);},e.fromString(Q));},linkFromUrl:function(S,T){return b.map(function(U){return{$:0,$0:U};},b.bind(function(V){return f.stringToId(V);},d.tryGetHash(S,T)));},linkToUrl:function(W,X){return e.fromString(W+$$.String(f.fromId(X.$0))).$0;},tryGetHash:function(Y,Z){var _0,_1;_0=$$.String(Z);if(g.StartsWith(_0,Y)){return{$:1,$0:_0.substring(Y.length)};}else{_1="http://"+_0;return g.StartsWith(_1,Y)?{$:1,$0:_1.substring(Y.length)}:{$:0};}}},Controls:{Shorten:$.Class({get_Body:function(){return h.Main();}}),Stats:$.Class({get_Body:function(){return i.Main();}})},Hash:{T:$.Class({toString:function(){return this.$0;}}),alphabet:$.Field(function(){return j.concat(j.ofArray([k.toList(l.range(65,90)),k.toList(l.range(48,57))]));}),alphabetLen:$.Field(function(){return f.alphabet().get_Length();}),fromId:function(_2){var _3,_4;_3="";_4=_2;while(_4>0){_3=_3+m.fromCharCode(f.alphabet().get_Item(_4%f.alphabetLen()<<0));_4=_4/f.alphabetLen()>>0;}return $.New(n,{$:0,$0:_3});},indexOf:$.Field(function(){var _5;_5=p.OfArray(k.toArray(j.zip(f.alphabet(),k.toList(l.range(0,f.alphabet().get_Length()-1)))));return function(_6){return _5.get_Item(_6);};}),stringToId:function(_7){var _;if(_7.indexOf("/")!=-1){return{$:0};}else{try{return{$:1,$0:j.foldBack(function(_8){return function(_9){return _9*f.alphabetLen()+(f.indexOf())(_8);};},j.ofSeq(_7),0)};}catch(_){return{$:0};}}},toId:function(ba){return f.stringToId(ba.$0).$0;}},ShortenPagelet:{Main:function(){var ba,bb;ba=r.Input(j.ofArray([r.Text("")]));bb=r.Button(j.ofArray([r.Text("Kürzen")]));h.wireUp(bb,ba);return s.add(r.Div(j.ofArray([ba,bb])),j.ofArray([r.Attr().Class("eingabe")]));},enableElement:function(bc,bd){return!bd?bc["HtmlProvider@32"].SetAttribute(bc.Body,"disabled",""):bc["HtmlProvider@32"].RemoveAttribute(bc.Body,"disabled");},getValue:function(be,bf){return be(bf.get_Value());},requestShortenedUrl:function(bh,bi){return t.Start(t.Delay(function(){return t.Bind(u.Async("SharpShortener:0",[bi]),function(bk){return t.Return(bh(bk));});}));},setText:function(bl,bm){return bl.set_Text(bm);},setValue:function(bn,bo,bp){return bo.set_Value(bn(bp));},wireUp:function(bq,br){var bs,bv,bx,bz,bB,bI,bK;bs=function(bt){return h.getValue(function(bu){return e.fromString(bu);},br,bt);};bv=function(bw){return $$.String(bw);};bx=function(){return"";};bz=function(){if(bs(null).$==0){h.enableElement(bq,false);return h.setText(bq,"...");}else{h.enableElement(bq,true);return h.setText(bq,"kürzen");}};bB=function(){return function(){var bE,bF,bG;bE=bs(null);if(bE.$==0){return null;}else{bF=bE.$0;bG=function(bH){h.enableElement(bq,true);h.enableElement(br,true);if(bH.$==0){h.setValue(bx,br,null);}else{h.setValue(bv,br,bH.$0);br.Body.select();}return bz(null);};h.enableElement(bq,false);h.enableElement(br,false);return h.requestShortenedUrl(bG,bF);}};};v.Events().OnClick(bB,bq);bI=function(){return bz(null);};v.Events().OnChange(bI,br);bK=function(){return function(){return bz(null);};};v.Events().OnKeyUp(bK,br);return h.enableElement(bq,false);}},StatsPagelet:{Main:function(){var bN,bO;bN=r.Button(j.ofArray([r.Text("Test")]));s.OnAfterRender(function(bP){return bP.Body.addEventListener("click",function(){return w("Hallo");},false);},bN);bO=bN;bO.Body.addEventListener("click",function(){return w("Welt");},false);return s.add(r.Div(j.ofArray([r.H2(j.ofArray([r.Text("Besucherzähler der registrierten Seiten")])),i.StatsChart(),bO])),j.ofArray([r.Attr().Class("statistik")]));},StatsChart:function(){var bS;bS=r.Div($.New(x,{$:0}));s.OnAfterRender(function(bT){var bU;bU={};bU.position="bottom";return i.getStatsData(new A(bT.Body),{width:600,height:300,legend:bU,title:"Hitcounter"});},bS);return bS;},getStatsData:function(bV,bW){return t.Start(t.Delay(function(){var bY,bZ;bY=u.Call("SharpShortener:1",[]);bZ=new B();bZ.addColumn("string","url");bZ.addColumn("number","#hits");C.iter($.Tupled(function(b0){var b1,b2,b3;b1=b0[0];b2=b0[1];b3=bZ.addRow();bZ.setValue(b3,0,e.nameOnly(b1));return bZ.setValue(b3,1,b2);}),bY);bV.draw(bZ,bW);return t.Return(null);}));}},Url:{T:$.Class({toString:function(){return this.$0;}}),fromString:function(b4){return e.isValidUrl(b4.toLowerCase())?{$:1,$0:$.New(D,{$:0,$0:e.withProtocol(b4)})}:{$:0};},isValidUrl:function(b5){return(new E(e.pattern())).test(b5);},nameOnly:function(b6){return e.withoutWWW(e.withoutProtocol($$.String(b6.$0).toLowerCase()));},pattern:$.Field(function(){return"^(https?:\\/\\/)?(www\\.)?(\\w+.?)+$";}),withProtocol:function(b7){return(g.StartsWith(b7,"http://")?true:g.StartsWith(b7,"https://"))?b7:"http://"+b7;},withoutProtocol:function(b8){return g.Replace(g.Replace(b8,"http://",""),"https://","");},withoutWWW:function(b9){return g.Replace(b9,"www.","");}}}});$.OnInit(function(){a=$.Safe($$.IntelliFactory.WebSharper);b=$.Safe(a.Option);c=$.Safe($$.SharpShortener);d=$.Safe(c.Addresse);e=$.Safe(c.Url);f=$.Safe(c.Hash);g=$.Safe(a.Strings);h=$.Safe(c.ShortenPagelet);i=$.Safe(c.StatsPagelet);j=$.Safe(a.List);k=$.Safe(a.Seq);l=$.Safe(a.Operators);m=$.Safe($$.String);n=$.Safe(f.T);o=$.Safe(a.Collections);p=$.Safe(o.MapModule);q=$.Safe(a.Html);r=$.Safe(q.Default);s=$.Safe(q.Operators);t=$.Safe(a.Concurrency);u=$.Safe(a.Remoting);v=$.Safe(q.EventsPervasives);w=$.Safe($$.alert);x=$.Safe(j.T);y=$.Safe($$.google);z=$.Safe(y.visualization);A=$.Safe(z.ColumnChart);B=$.Safe(z.DataTable);C=$.Safe(a.Arrays);D=$.Safe(e.T);return E=$.Safe($$.RegExp);});$.OnLoad(function(){e.pattern();f.indexOf();f.alphabetLen();f.alphabet();return;});}());
